<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å­¦ä¹ è¿›åº¦æ€»è§ˆ</title>
    <style>
        :root { --bg-color: transparent; --card-bg: rgba(255, 255, 255, 0.9); --text-main: #37352f; --text-sub: #777; --accent: #2383e2; --success: #2ea043; }
        body { margin: 0; padding: 20px; font-family: -apple-system, sans-serif; background-color: var(--bg-color); color: var(--text-main); display: flex; flex-direction: column; align-items: center; }
        h1 { font-size: 20px; margin-bottom: 20px; opacity: 0.9; }
        .grid-container { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; width: 100%; max-width: 600px; }
        .card { background: var(--card-bg); border-radius: 12px; padding: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); display: flex; flex-direction: column; transition: transform 0.2s; text-decoration: none; color: inherit; border: 1px solid rgba(0,0,0,0.05); }
        .card:hover { transform: translateY(-3px); box-shadow: 0 8px 20px rgba(0,0,0,0.1); }
        .card-title { font-size: 15px; font-weight: 600; margin-bottom: 5px; }
        .card-round { font-size: 28px; font-weight: 800; margin-bottom: 8px; color: var(--text-main); }
        .card-round span { font-size: 12px; color: var(--text-sub); font-weight: normal; }
        .mini-progress-track { width: 100%; height: 6px; background: rgba(0,0,0,0.05); border-radius: 3px; overflow: hidden; margin-top: auto; }
        .mini-progress-fill { height: 100%; width: 0%; background: var(--accent); border-radius: 3px; }
        .completed .mini-progress-fill { background: var(--success); }
        .status-text { font-size: 11px; color: var(--text-sub); margin-top: 6px; display: flex; justify-content: space-between; }
        @media (prefers-color-scheme: dark) { :root { --card-bg: rgba(40,40,40, 0.9); --text-main: #fff; --text-sub: #aaa; } }
    </style>
</head>
<body>
    <h1>ğŸ“š å¤ä¹ å…¨æ™¯å›¾</h1>
    <div class="grid-container" id="card-grid"></div>

    <script>
        // === é…ç½®åŒºåŸŸ ===
        // è¿™é‡Œå®šä¹‰ä½ æƒ³åœ¨ä»ªè¡¨ç›˜ä¸Šçœ‹åˆ°å“ªäº›ç§‘ç›®
        const defaultSubjects = [
            { id: 'western', name: 'è¥¿æ–¹ç¾æœ¯å²' },
            { id: 'chinese', name: 'ä¸­å›½ç¾æœ¯å²' },
            { id: 'english', name: 'è€ƒç ”è‹±è¯­' },
            { id: 'politics', name: 'æ”¿æ²»' },
            { id: 'design', name: 'è®¾è®¡ç†è®º' }
        ];

        // === é€»è¾‘åŒºåŸŸ ===
        const urlParams = new URLSearchParams(window.location.search);
        const idsParam = urlParams.get('ids');
        const subjects = idsParam ? idsParam.split(',').map(id => ({ id: id.trim(), name: id.toUpperCase() })) : defaultSubjects;

        const grid = document.getElementById('card-grid');

        subjects.forEach(subj => {
            const storageKey = 'recite_data_' + subj.id;
            const savedData = localStorage.getItem(storageKey);
            
            let round = 0, percent = 0, total = 0, checked = 0;

            if (savedData) {
                try {
                    const data = JSON.parse(savedData);
                    round = data.round || 0;
                    const tempDiv = document.createElement('div');
                    if (data.listHtml) {
                        tempDiv.innerHTML = data.listHtml;
                        const checkboxes = tempDiv.querySelectorAll('input[type="checkbox"]');
                        total = checkboxes.length;
                        checked = Array.from(checkboxes).filter(cb => cb.hasAttribute('checked') || cb.checked).length;
                        if (total > 0) percent = Math.round((checked / total) * 100);
                    }
                } catch (e) { console.warn('Data error', e); }
            }

            // ã€é‡ç‚¹ã€‘è¿™é‡Œè®¾ç½®ç‚¹å‡»å¡ç‰‡è·³è½¬çš„è·¯å¾„
            // å› ä¸ºèƒŒè¯µç»„ä»¶åœ¨ todo æ–‡ä»¶å¤¹ä¸‹ï¼Œæ‰€ä»¥è·¯å¾„æ˜¯ ./todo/index.html
            const cardLink = `./todo/index.html?id=${subj.id}&title=${encodeURIComponent(subj.name)}`;
            
            const isCompleted = (percent === 100 && total > 0);
            const progressClass = isCompleted ? 'mini-progress-fill completed' : 'mini-progress-fill';

            const card = document.createElement('a');
            card.className = 'card';
            card.href = cardLink;
            card.target = "_blank"; // ç‚¹å‡»åœ¨æ–°çª—å£æ‰“å¼€èƒŒè¯µå•

            card.innerHTML = `
                <div class="card-title">${subj.name}</div>
                <div class="card-round">${round} <span>è½®</span></div>
                <div class="mini-progress-track">
                    <div class="${progressClass}" style="width: ${percent}%"></div>
                </div>
                <div class="status-text">
                    <span>è¿›åº¦ ${percent}%</span>
                    <span>${checked}/${total}</span>
                </div>
            `;
            grid.appendChild(card);
        });
    </script>
</body>
</html>